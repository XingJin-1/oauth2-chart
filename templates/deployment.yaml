apiVersion: apps/v1

kind: Deployment

metadata: 
  name: xing-appserver-deployment

spec:

  replicas: 1

  selector:
    matchLabels:
      app: xing-myapp
  
  template:
    metadata:
      labels:
        app: xing-myapp
    spec:
      containers:
        - name: xing-oauth2-proxy
          volumeMounts:
            - name: xing-myapp-tls
              mountPath: /etc/tls/private
          terminationMessagePolicy: File
          args:
            - --provider=oidc
            - --oidc-issuer-url=https://federate.infineon.com
            - --email-domain=*
            - --upstream=http://localhost:4200
            - --https-address=:8080
            - --redirect-url=https://oauth2-playground-xj-1.eu-de-3.icp.infineon.com/oauth2/callback
            - --client-id=rddl 
            - --client-secret=IaZNevN6glcw1k0A4luKtL1cjh1nWErddiMYIE418rVQ8pwoMmRBbe0kVIgQXwGX
            - --cookie-secret=dJUszKDhOZ5MBlA5LDuunawk84Bea7UyNseujkqMA6U=
            - --prompt=none
            - --tls-cert-file=/etc/tls/private/tls.crt
            - --tls-key-file=/etc/tls/private/tls.key
            - --show-debug-on-error=true 
            - --errors-to-info-log=true
            - --pass-authorization-header=true 
            - --set-authorization-header=true
            - --pass-access-token=true
            - --set-xauthrequest=true
          env:
          - name: OAUTH2_PROXY_CLIENT_ID
            value: rddl
          - name: OAUTH2_PROXY_CLIENT_SECRET
            value: oKlbVzzdP7qxOCDDKmdzUJD1vNMwReR4p2KLLEMg8zRQKSmvQZcBT3naIdYW2rYV
          - name: OAUTH2_PROXY_COOKIE_SECRET
            value: dJUszKDhOZ5MBlA5LDuunawk84Bea7UyNseujkqMA6U=
          image: quay.io/oauth2-proxy/oauth2-proxy:latest
          imagePullPolicy: Always
          name: oauth2-proxy
          ports:
          - containerPort: 8080
            protocol: TCP
        - name: xing-myapp
          image: openshift-registry.eu-de-3.icp.infineon.com/playground-xj-1/vue-app-15
          imagePullPolicy: Always
          ports:
            - containerPort: 4200          
          resources:
            requests:
              memory: 1Gi
              cpu: 750m
            limits:
              memory: 1Gi
              cpu: 750m
      volumes:
        - name: xing-myapp-tls
          secret:
            secretName: xing-myapp-tls